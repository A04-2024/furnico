<!-- report/templates/report/create_report.html -->
<div id="report-popup" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
    background-color: white; padding: 20px; border: 1px solid #ccc; z-index: 1000;">
    <form id="report-form" method="post">
        {% csrf_token %}
        <h3>Pilih Alasan Laporan:</h3>
        {{ form.reason }}
        <div id="additional-info" style="display: none;">
            <h4>Info Tambahan:</h4>
            {{ form.additional_info }}
        </div>
        <button type="button" id="cancel-button" aria-label="Cancel Report">Cancel</button>
        <button type="submit" id="submit-button" disabled>Submit</button>
    </form>
    <div id="thank-you-message" style="display: none;">
        <p>Terima Kasih Atas Laporan Anda</p>
        <button type="button" id="exit-button">Keluar</button>
    </div>
</div>

<script>
// JavaScript untuk mengontrol form
document.addEventListener('DOMContentLoaded', function() {
    const reasonRadios = document.querySelectorAll('input[name="reason"]');
    const additionalInfo = document.getElementById('additional-info');
    const submitButton = document.getElementById('submit-button');
    const cancelButton = document.getElementById('cancel-button');
    const exitButton = document.getElementById('exit-button');
    const reportForm = document.getElementById('report-form');
    const thankYouMessage = document.getElementById('thank-you-message');

    reasonRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            additionalInfo.style.display = 'block';
            submitButton.disabled = false;
        });
    });

    cancelButton.addEventListener('click', function() {
        document.getElementById('report-popup').style.display = 'none';
    });

    reportForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(reportForm);
        fetch("{% url 'report:create_report' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            reportForm.style.display = 'none';
            thankYouMessage.style.display = 'block';
        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        });
    });

    exitButton.addEventListener('click', function() {
        document.getElementById('report-popup').style.display = 'none';
    });
});
</script>
