{% extends 'base.html' %}
{% block content %}
{% include 'navbar.html' %}
<script defer src="https://unpkg.com/alpinejs@3.2.3/dist/cdn.min.js"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="flex flex-col px-8 py-2 my-32">
    <div class="p-8">
        {% include "carousel.html" %}
    </div>
    
    <div class="px-8">
        <h1 class="text-4xl font-extrabold pb-2">Halo {{ request.user.username }}! Jelajahi kategori unggulan kami</h1>
        <h3 class="text-xl">Temukan beragam produk yang sesuai dengan gaya dan kebutuhan Anda.</h3>
    </div>

    <!-- Category carousel -->
    <div class="py-8 md:p-8">
    <div class="relative w-full">
        <!-- Slider Container -->
        <div id="category_slider" class="flex space-x-4 overflow-x-auto no-scrollbar scroll-smooth w-full px-16">
            <!-- The dynamically added categories will be injected here -->
        </div>

        <!-- Left Button -->
        <button id="leftButton" class="absolute left-4 top-1/2 -translate-y-1/2 bg-transparent p-3 rounded-full hover:bg-white hover:bg-opacity-30">
            <svg class="w-8 h-8 text-gray-500 hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path>
            </svg>
        </button>

        <!-- Right Button -->
        <button id="rightButton" class="absolute right-4 top-1/2 -translate-y-1/2 bg-transparent p-3 rounded-full hover:bg-white hover:bg-opacity-30">
            <svg class="w-8 h-8 text-gray-500 hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path>
            </svg>
        </button>
    </div>
    </div>


    <div class="p-8 pb-0">
        <h1 class="text-4xl font-extrabold pb-2 p">Produk Populer</h1>
        <h3 class="text-xl pb-4">Temukan penawaran menarik untuk melihat yang sedang hits di Furnico.</h3>
        {% if request.user.is_authenticated and request.user.userprofile.role == 'admin' %}
        <button data-modal-target="crudModal" data-modal-toggle="crudModal" class="mb-4 px-6 py-2 bg-black bg-opacity-80 rounded-full hover:bg-opacity-100 text-zinc-50 font-bold" onclick="showModal();">Tambah Produk Baru</button>
        <button data-modal-target="category_modal" data-modal-toggle="category_modal" class="mb-4 px-6 py-2 bg-black bg-opacity-80 rounded-full hover:bg-opacity-100 text-zinc-50 font-bold" onclick="showModalCat();">Tambah Kategori Baru</button>
        {% endif %}
    </div>

    <div id="product-list"></div>
    <div id="default_tampilan"></div>
    
    <br />

    <!-- article -->
    <div class="px-8">
        <h1 class="text-4xl font-extrabold pb-2">Terbaru di Furnico</h1>
        <h3 class="text-xl">Butuh inspirasi? Cek ide-ide ruangan kami yang telah dikurasi di artikel Furnico!</h3>
    </div>
    <div>
    {% if not articles %}
    <div class="px-8">
        <a href="/article" class="text-xl font-medium text-blue-600 hover:text-blue-800 underline decoration-dotted transition duration-300 ease-in-out">
            Go to Articles
        </a>
    </div>    
    {% else %}
    <!-- Responsive grid for articles -->
    <div class="articles-list grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
    {% for article in articles %}
    <div class="article-card bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-200">

        {% if article.image %}
        <img src="{{ article.image.url }}" alt="Article Image" class="w-full h-48 object-cover mb-4 rounded-lg">
        {% endif %}
        
        <h2 class="text-xl font-semibold mb-2 text-blue-500 hover:text-blue-700 transition-colors duration-200">
        <a href="{% url 'article:article_detail' article.id %}" class="hover:underline">{{ article.title }}</a>
        </h2>
        <p class="text-gray-400 mb-2">
        <em>By: {{ article.author.username }}</em> <!-- Displaying the author's name -->
        </p>
        <p class="text-gray-400 text-sm mb-4">
        <em>Created at: {{ article.created_at }}</em>
        </p>
        
        <!-- Strip HTML tags and truncate content preview -->
        <div class="article-content">
        <p class="text-gray-600 mb-4">{{ article.content|striptags|truncatewords:20 }}</p>
        <a href="{% url 'article:article_detail' article.id %}" class="text-blue-500 hover:underline font-medium">Read More</a>
        </div>
    </div>
    {% endfor %}
    </div>
    {% endif %}
    </div>
</div>

<!-- wishlist modal -->
<div id="add-wishlist-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg w-96 p-6 relative">
        <h2 class="text-2xl font-bold mb-4">Add to Wishlist</h2>
        <p>Select a wishlist to add this product:</p>


        <select id="wishlist-collection" class="mt-4 w-full p-2 border rounded">

        </select>

        <input type="hidden" id="product-entry-id" />

        <button id="confirm-add-wishlist" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Add to Wishlist</button>
        <button id="cancel-add-wishlist" class="mt-2 text-gray-600">Cancel</button>
    </div>
</div>

<!-- product make modal -->
<div id="crudModal" tabindex="-1" aria-hidden="true" 
  class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50 overflow-x-hidden overflow-y-auto transition-opacity duration-300 ease-out">

  <div id="crudModalContent" class="container max-w-screen-lg mx-auto">
    <div class="bg-white rounded shadow-lg p-4 px-4 md:p-8 mb-6">
      <div class="grid gap-4 gap-y-2 text-sm grid-cols-1 lg:grid-cols-3">
        <div class="text-gray-600">
          <p class="font-medium text-lg">Detail Produk</p>
          <p>Harap isi semua kolom.</p>
          <div class="text-red-600 text-sm">{{ form.errors }}</div>
        </div>

        <div class="lg:col-span-2">
          <form id="productEntryForm" method="POST">
            {% csrf_token %}
            <div class="grid gap-4 gap-y-2 text-sm grid-cols-1 md:grid-cols-5">
              <div class="md:col-span-5">
                <label for="product_name">Nama Produk</label>
                <input type="text" name="product_name" id="product_name" max_length=255 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" value="" />
              </div>

              <div class="md:col-span-5">
                <label for="product_subtitle">Subtitel Produk</label>
                <input type="text" name="product_subtitle" id="product_subtitle" maxlength=255 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" 
                  placeholder="Penjelasan singkat produk" />
              </div>

              <div class="md:col-span-5">
                <label for="product_image">Tautan Gambar Produk</label>
                <input type="url" name="product_image" id="product_image" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
              </div>

              <div class="md:col-span-3">
                <label for="product_category">Kategori Produk</label>
                <select id="product_category" name="product_category" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50">
                  {% for category in categories %}
                    <option value={{category.id}}>{{ category.category_name }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="md:col-span-2">
                <label for="product_price">Harga Produk</label>
                <input type="number" name="product_price" id="product_price" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
              </div>

              <div class="md:col-span-2">
                <label for="sold_this_week">Terjual Minggu Ini</label>
                <input type="number" name="sold_this_week" id="sold_this_week" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
              </div>

              <div class="md:col-span-2">
                <label for="people_bought">Jumlah Produk Terjual</label>
                <input type="number" name="people_bought" id="people_bought" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
              </div>

              <div class="md:col-span-5">
                <label for="product_description">Deskripsi Produk</label>
                <textarea name="product_description" id="product_description" 
                  class="border mt-4 rounded px-4 w-full bg-gray-50 h-20 text-left placeholder:text-left" 
                  placeholder="Penjelasan detail produk"></textarea>
              </div>
              
              <div class="md:col-span-5">
                  <label for="product_advantages">Kelebihan Produk</label>
                  <textarea name="product_advantages" id="product_advantages" 
                    class="border mt-4 rounded px-4 w-full bg-gray-50 h-20 text-left placeholder:text-left" 
                    placeholder="Penjelasan kelebihan produk"></textarea>
              </div>
            
            

              <div class="md:col-span-5">
                <label for="product_material">Bahan Produk</label>
                <input type="text" name="product_material" id="product_material" maxlength=225 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" 
                  placeholder="Penjelasan bahan produk" />
              </div>

              <div class="md:col-span-1">
                <label for="product_size_length">Lebar produk</label>
                <input type="number" name="product_size_length" id="product_size_length" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
              </div>

              <div class="md:col-span-1">
                <label for="product_size_height">Tinggi produk</label>
                <input type="number" name="product_size_height" id="product_size_height" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
              </div>

              <div class="md:col-span-1">
                <label for="product_size_long">Panjang produk</label>
                <input type="number" name="product_size_long" id="product_size_long" 
                  class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
              </div>

              <div class="md:col-span-5 text-right">
                <button type="button" id="cancelButton" class="mb-4 px-6 py-2 bg-black bg-opacity-80 rounded-full hover:bg-opacity-100 text-zinc-50 font-bold">Batal</button>
                <input type="submit" value="Tambah Produk" id="submitProductEntry" form="productEntryForm"
                  class="mb-4 px-6 py-2 bg-blue-500 bg-opacity-80 rounded-full hover:bg-opacity-100 text-zinc-50 font-bold" />
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- category make modal -->
<div id="category_modal" class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50 overflow-x-hidden overflow-y-auto transition-opacity duration-300 ease-out">
    <!-- Modal Content -->
    <div id="category_modal_content" class="modal-content bg-white rounded shadow-lg p-4 px-4 md:p-8 mb-6 z-50 relative">
      <div class="grid gap-4 gap-y-2 text-sm grid-cols-1 lg:grid-cols-3">
        <div class="text-gray-600">
          <p class="font-medium text-lg">Detail Kategori</p>
          <p>Harap isi semua kolom.</p>
          <div class="text-red-600 text-sm">{{ form.errors }}</div>
        </div>
        <div class="lg:col-span-2"> 
          <form method="POST" id="categoryForm">
            {% csrf_token %}
            <div class="grid gap-4 gap-y-2 text-sm grid-cols-1 md:grid-cols-5">
              <div class="md:col-span-5">
                <label for="category_name">Nama Kategori</label>
                <input type="text" name="category_name" id="category_name" max_length=255 class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" value="" />
              </div>
  
              <div class="md:col-span-5 pb-4">
                <label for="image_url">Tautan Gambar Kategori</label>
                <input type="url" name="image_url" id="image_url" class="rounded-md h-10 border mt-1 rounded px-4 w-full bg-gray-50" value="" placeholder="" />
              </div>
  
              <div class="md:col-span-5 text-right">
                  <button type="button" id="cancelButtonCat" class="mb-4 px-6 py-2 bg-black bg-opacity-80 rounded-full hover:bg-opacity-100 text-zinc-50 font-bold">Cancel</button>
                  <input type="submit" value="Tambah Kategori" class="mb-4 px-6 py-2 bg-blue-500 bg-opacity-80 rounded-full hover:bg-opacity-100 text-zinc-50 font-bold"/>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>


<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('slider', () => ({
            currentIndex: 1,
            images: [
                'https://d2xjmi1k71iy2m.cloudfront.net/dairyfarm/id/pageImages/page__en_us_1726675984779_0_1.webp',
                'https://d2xjmi1k71iy2m.cloudfront.net/dairyfarm/id/pageImages/page__en_us_1726675985899_0_5.webp',
                'https://d2xjmi1k71iy2m.cloudfront.net/dairyfarm/id/pageImages/page__en_us_1729592407263__1.webp',
            ],
            back() {
                if (this.currentIndex > 1) {
                    this.currentIndex = this.currentIndex - 1;
                }
            },
            next() {
                if (this.currentIndex < this.images.length) {
                    this.currentIndex = this.currentIndex + 1;
                } else if (this.currentIndex <= this.images.length){
                    this.currentIndex = this.images.length - this.currentIndex + 1
                }
            },
        }))
    })

    // Category carousel
    $('#carouselExample').on('slide.bs.carousel', function(e) {
        var $e = $(e.relatedTarget);
        var idx = $e.index();
        var itemsPerSlide = 4;
        var totalItems = $('.carousel-item').length;

        if (idx >= totalItems - (itemsPerSlide - 1)) {
            var it = itemsPerSlide - (totalItems - idx);
            for (var i = 0; i < it; i++) {
                // append slides to end
                if (e.direction == "left") {
                    $('.carousel-item').eq(i).appendTo('.carousel-inner');
                } else {
                    $('.carousel-item').eq(0).appendTo('.carousel-inner');
                }
            }
        }
    });

    $('#carouselExample').carousel({
        interval: 2000
    });


</script>

<!-- buat livesearch -->
<script>
    function searchProducts(query) {
        fetch(`/search/?q=${query}`)
            .then(response => response.json())
            .then(data => {
                const productList = document.getElementById('product-list');
                productList.className = "flex flex-row justify-start py-8 md:p-8 flex-wrap"
                productList.innerHTML = ''; // Clear previous results

                if (data.products.length === 0) {
                    productList.innerHTML = `
                    <div class="w-full flex flex-col items-center justify-center">
                        <p class="text-xl text-center mb-4">Produk tidak ditemukan :(</p>
                        <img src="https://global-uploads.webflow.com/63c864d518fab2c78dbdbef6/63c864d518fab282d1bdc13d_empty.gif" alt="empty image">
                    </div>
                    `;
                } else {
                    let count = 0; // Initialize counter for displayed products

                    data.products.forEach(product => {
                        if (count >= 10) return; // Stop after 10 products

                        productList.innerHTML += `
                            <div class="max-w-2xl mx-auto p-2 shrink justify-start justify-items-start justify-self-start">
                    <div class="bg-white shadow-md rounded-lg max-w-80 border-gray-700 justify-start justify-items-start justify-self-start">
                        <a href="/product/${product.id}">
                            <img class="rounded-t-lg p-8" src="${product.product_image}" alt="product image">
                        </a>
                            <div class="px-5 pb-5">
                                <a href="/product/${product.id}">
                                    <h3 class="text-black-900 font-extrabold text-2xl tracking-tight">${product.product_name}</h3>
                                    <h3 class="text-black-900 font-semibold text-xl tracking-tight text-wrap text-clip overflow-hidden">${product.product_subtitle}</h3>
                                </a>
                                <div class="flex justify-between">
                                <div class="flex items-center mt-2.5 mb-2">
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <span class="bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800 ml-3">5.0</span>
                                                                        </div>
                                    <div>
                                        ${product.in_wishlist ? `
                                            <button onclick="removeFromWishlist('${product.id}')" class="wishlist-btn filled">
                                                <svg class="h-9 lg:h-10 p-2 text-gray-500" viewBox="0 0 22 22" aria-hidden="true" focusable="false" data-prefix="far" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill="red" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
                                                </svg>
                                            </button>` : `
                                            <button product-entry-id="${product.id}" class="add-wishlist-btn">
                                                <svg class="h-9 lg:h-10 p-2 text-gray-500" aria-hidden="true" focusable="false" data-prefix="far" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                                    <path fill="currentColor" d="M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"></path>
                                                </svg>
                                            </button>`}
                                    </div>
                                </div>
                                <div class="flex items-center justify-between pb-4">
                                    <span class="text-xl font-bold text-black-900">Rp${product.product_price}</span>
                                    
                                </div>

                                <!-- TAMBAHIN PENGECEKAN USER ADMIN ATAU BUKAN DISINI -->
                                {% if request.user.is_authenticated and request.user.userprofile.role == 'admin' %}
                                <div class="flex items-center justify-between">
                                        <button data-modal-target="delProductModal" data-modal-toggle="delProductModal" class="mb-4 px-3 py-2 bg-red-500 rounded-full hover:bg-red-700 text-white font-bold transition-colors duration-300" onclick="showModalProduct('${product.id}')">
                                            Hapus Produk
                                        </button>
                                    
                                    <a href="/edit_product/${product.id}">
                                        <button class="mb-4 px-3 py-2 bg-blue-500 rounded-full hover:bg-blue-700 text-white font-bold transition-colors duration-300">
                                            Edit Produk
                                        </button>
                                    </a>
                                    
                                </div>
                                {% endif %}
                            </div>
                    </div>

                </div>
                            `;
                        
                        count++; // Increment counter
                    });

                    document.getElementById("default_tampilan").style.display = "none";
                }
            })
            .catch(error => console.error('Error fetching products:', error));
    }

</script>

<!-- buat ajax -->
<script>
    async function getProductEntries() {
    // Fetch data from the endpoint
    const response = await fetch("/json/");
    
    // Check if the response is OK (status in the range 200-299)
    if (!response.ok) {
        throw new Error('Network response was not ok');
    }
    
    // Parse the response to JSON
    const products = await response.json();
    
    // Return only the first 10 products
    return products.slice(0, 10);
}


    async function refreshProductEntries() {
        document.getElementById("default_tampilan").innerHTML = "";
        const productEntries = await getProductEntries();
        let htmlString = "";

        if (productEntries.length === 0) {
            htmlString = `
            <div class="w-full flex flex-col items-center justify-center">
                <p class="text-xl text-center mb-4">Belum ada data product pada kategori ini :(</p>
                <img src="https://global-uploads.webflow.com/63c864d518fab2c78dbdbef6/63c864d518fab282d1bdc13d_empty.gif" alt="empty image">
            </div>
            `;
        }
        else {
            productEntries.forEach((item) => {
                htmlString += `
                <div class="max-w-2xl mx-auto p-2 shrink justify-start justify-items-start justify-self-start">
                    <div class="bg-white shadow-md rounded-lg max-w-80 border-gray-700 justify-start justify-items-start justify-self-start">
                        <a href="/product/${item.pk}">
                            <img class="rounded-t-lg p-8" src="${item.fields.product_image}" alt="product image">
                        </a>
                            <div class="px-5 pb-5">
                                <a href="/product/${item.pk}">
                                    <h3 class="text-black-900 font-extrabold text-2xl tracking-tight">${item.fields.product_name}</h3>
                                    <h3 class="text-black-900 font-semibold text-xl tracking-tight text-wrap text-clip overflow-hidden">${item.fields.product_subtitle}</h3>
                                </a>
                                <div class="flex justify-between">
                                <div class="flex items-center mt-2.5 mb-2">
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                                        </path>
                                    </svg>
                                    <span class="bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800 ml-3">5.0</span>
                                    </div>
                                    <div>
                                        ${item.fields.in_wishlist ? `
                                            <button onclick="removeFromWishlist('${item.pk}')" class="wishlist-btn filled">
                                                <svg class="h-9 lg:h-10 p-2 text-gray-500" viewBox="0 0 22 22" aria-hidden="true" focusable="false" data-prefix="far" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill="red" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
                                                </svg>
                                            </button>` : `
                                            <button product-entry-id="${item.pk}" class="add-wishlist-btn">
                                                <svg class="h-9 lg:h-10 p-2 text-gray-500" aria-hidden="true" focusable="false" data-prefix="far" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                                    <path fill="currentColor" d="M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"></path>
                                                </svg>
                                            </button>`}
                                    </div>
                                </div>
                                <div class="flex items-center justify-between pb-4">
                                    <span class="text-xl font-bold text-black-900">Rp${item.fields.product_price}</span>
                                    
                                </div>

                                <!-- TAMBAHIN PENGECEKAN USER ADMIN ATAU BUKAN DISINI -->
                                {% if request.user.is_authenticated and request.user.userprofile.role == 'admin' %}
                                <div class="flex items-center justify-between">
                                        <button data-modal-target="delProductModal" data-modal-toggle="delProductModal" class="mb-4 px-3 py-2 bg-red-500 rounded-full hover:bg-red-700 text-white font-bold transition-colors duration-300" onclick="showModalProduct('${item.pk}')">
                                            Hapus Produk
                                        </button>
                                    
                                    <a href="/edit_product/${item.pk}">
                                        <button class="mb-4 px-3 py-2 bg-blue-500 rounded-full hover:bg-blue-700 text-white font-bold transition-colors duration-300">
                                            Edit Produk
                                        </button>
                                    </a>
                                    
                                </div>
                                {% endif %}
                            </div>
                    </div>

                </div>
                `;
            });
            htmlString += `
            <div class="w-full mt-4">
                <a href="{% url 'show_products:show_all_products' %}"
						class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-2 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Lihat Semua Produk</a>
            </div>`;
        }
        document.getElementById("default_tampilan").className = "flex flex-row justify-start py-8 md:p-8 flex-wrap";
        document.getElementById("default_tampilan").innerHTML = htmlString;
    }
    refreshProductEntries();
</script>

<!-- buat modal -->
<script>
      const modal = document.getElementById('crudModal');
      const modalContent = document.getElementById('crudModalContent');
    
      function showModal() {
          const modal = document.getElementById('crudModal');
          const modalContent = document.getElementById('crudModalContent');
    
          modal.classList.remove('hidden'); 
          setTimeout(() => {
            modalContent.classList.remove('opacity-0', 'scale-95');
            modalContent.classList.add('opacity-100', 'scale-100');
          }, 50); 
      }
    
      function hideModal() {
          const modal = document.getElementById('crudModal');
          const modalContent = document.getElementById('crudModalContent');
    
          modalContent.classList.remove('opacity-100', 'scale-100');
          modalContent.classList.add('opacity-0', 'scale-95');
    
          setTimeout(() => {
            modal.classList.add('hidden');
          }, 150); 
      }
    
      document.getElementById("cancelButton").addEventListener("click", hideModal);
      document.getElementById("closeModalBtn").addEventListener("click", hideModal);
</script>

<!-- buat nambah produk ajax -->
<script>
    function addProductEntry() {
      fetch("{% url 'show_products:create_product_entry_ajax' %}", {
        method: "POST",
        body: new FormData(document.querySelector('#productEntryForm')),
      })
      .then(response => refreshProductEntries())
  
      document.getElementById("productEntryForm").reset(); 
      document.querySelector("[data-modal-toggle='crudModal']").click();
  
      return false;
    }

    document.getElementById("productEntryForm").addEventListener("submit", (e) => {
        e.preventDefault();
        console.log("Form submitted");
        addProductEntry();
    })
</script>

<!-- buat card slider -->
<style>
/* Hide the scrollbar */
#slider::-webkit-scrollbar {
    display: none;
}
#slider {
    -ms-overflow-style: none;  /* Internet Explorer 10+ */
    scrollbar-width: none;  /* Firefox */
}
</style>
<script>
    const slider = document.getElementById('category_slider');
    const leftButton = document.getElementById('leftButton');
    const rightButton = document.getElementById('rightButton');

    // Scroll left when the left button is clicked
    leftButton.addEventListener('click', () => {
      slider.scrollBy({ left: -300, behavior: 'smooth' });
    });

    // Scroll right when the right button is clicked
    rightButton.addEventListener('click', () => {
      slider.scrollBy({ left: 300, behavior: 'smooth' });
    });
</script>

<!-- get category json -->
<script>
async function getCategories(){
    return fetch("{% url 'show_products:show_json_cat' %}").then((res) => res.json())
}

 async function refreshCategories() {
    document.getElementById("category_slider").innerHTML = "";
    const categories = await getCategories();
    let htmlString = `
    <div class="min-w-[300px] max-w-[300px] relative rounded-lg overflow-hidden">
      <img src="https://i.ytimg.com/vi/VgUcVjEOVDM/maxresdefault.jpg" class="h-full w-full object-cover" alt="Image">
      <div class="absolute inset-0 bg-black bg-opacity-50 flex items-end justify-center">
        <a href="{% url 'show_products:show_all_products' %}" class="hover:underline">
          <button class="mb-4 px-6 py-2 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 font-bold">
            Tampilkan semua produk
          </button>
        </a>
      </div>
    </div>
    `;
  
    categories.forEach((item) => {
        htmlString += `
        <div class="min-w-[300px] max-w-[300px] relative rounded-lg overflow-hidden">
            <img src="${item.fields.image_url}" class="h-full w-full object-cover" alt="${item.fields.category_name}">
            <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center align-bottom">
            {% if request.user.is_authenticated and request.user.userprofile.role == 'admin' %}
                <div class="p-2">
                        <button data-modal-target="delCategoryModal" data-modal-toggle="delCategoryModal" class="px-6 py-2 bg-red-500 rounded-full hover:bg-red-700 text-white font-bold" onclick="showModalCategory('${item.pk}')">Hapus</button>
                </div>
                <div class="p-2">
                    <a href="/edit_category/${item.pk}" class="hover:underline p-2">
                        <button class="px-6 py-2 bg-blue-500 rounded-full hover:bg-blue-700 text-white font-bold">Edit</button>
                    </a>
                </div>
            {% endif %}
                <div class="p-2">
                    <a href="/all_product/${item.pk}" class="hover:underline">
                        <button class="mb-4 px-6 py-2 bg-white bg-opacity-80 rounded-full hover:bg-opacity-100 font-bold">${item.fields.category_name}</button>
                    </a>
                </div>
            </div>
        </div>
        `;
    });
    
    document.getElementById("category_slider").innerHTML = htmlString;
}
refreshCategories();
</script>

<!-- category modal -->
<script>
      const cat_modal = document.getElementById('category_modal');
      const cat_modalContent = document.getElementById('category_modal_content');
    
      function showModalCat() {
          const cat_modal = document.getElementById('category_modal');
          const cat_modalContent = document.getElementById('category_modal_content');
    
          cat_modal.classList.remove('hidden'); 
          setTimeout(() => {
            cat_modalContent.classList.remove('opacity-0', 'scale-95');
            cat_modalContent.classList.add('opacity-100', 'scale-100');
          }, 50); 
      }
    
      function hideModalCat() {
          const cat_modal = document.getElementById('category_modal');
          const cat_modalContent = document.getElementById('category_modal_content');
    
          cat_modalContent.classList.remove('opacity-100', 'scale-100');
          cat_modalContent.classList.add('opacity-0', 'scale-95');
    
          setTimeout(() => {
            cat_modal.classList.add('hidden');
          }, 150); 
      }
    
      document.getElementById("cancelButtonCat").addEventListener("click", hideModalCat);
      document.getElementById("closeModalBtnCat").addEventListener("click", hideModalCat);
</script>

<!-- tambah kategori ajax -->

<script>
  function addCategory() {
    fetch("{% url 'show_products:create_category_ajax' %}", {
      method: "POST",
      body: new FormData(document.querySelector('#categoryForm')),
    })
    .then(response => refreshCategories())

    document.getElementById("categoryForm").reset(); 
    document.querySelector("[data-modal-toggle='category_modal']").click();

    return false;
  }

  document.getElementById("categoryForm").addEventListener("submit", (e) => {
    e.preventDefault();
    addCategory();
  })
</script>

<div id="delProductModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div id="delProductModalContent" class="bg-white rounded-lg shadow-lg p-5">
        <h3 class="text-lg font-bold mb-4">Konfirmasi Penghapusan</h3>
        <p>Apakah Anda yakin ingin menghapus produk ini? Tindakan ini tidak dapat dibatalkan.</p>
        <div class="flex justify-end mt-4">
            <button type="button" id="cancelDeleteProduct" class="bg-gray-300 text-black px-4 py-2 rounded mr-2">Cancel</button>
            <button type="button" id="confirmDeleteProduct" class="bg-red-500 text-white px-4 py-2 rounded">Hapus</button>
        </div>
    </div>
</div>
<style>
#delProductModal {
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
}

#delProductModal .bg-white {
    width: 300px; /* Set width of modal */
}

</style>

<script>
    let productIdToDelete = null
    const delete_product_modal = document.getElementById('delProductModal');
    const delete_product_modalContent = document.getElementById('delProductModalContent');
    
      function showModalProduct(productId) {
          productIdToDelete = productId;
          const delete_product_modal = document.getElementById('delProductModal');
          const delete_product_modalContent = document.getElementById('delProductModalContent');
    
          delete_product_modal.classList.remove('hidden'); 
          setTimeout(() => {
            delete_product_modalContent.classList.remove('opacity-0', 'scale-95');
            delete_product_modalContent.classList.add('opacity-100', 'scale-100');
          }, 50); 
      }
    
      function hideModalProduct() {
          const delete_product_modal = document.getElementById('delProductModal');
          const delete_product_modalContent = document.getElementById('delProductModalContent');
    
          delete_product_modalContent.classList.remove('opacity-100', 'scale-100');
          delete_product_modalContent.classList.add('opacity-0', 'scale-95');
    
          setTimeout(() => {
            delete_product_modal.classList.add('hidden');
          }, 150); 
      }
      function deleteProduct(){
        window.location.href = `/delete_product/${productIdToDelete}`;
      }
      document.getElementById("cancelDeleteProduct").addEventListener("click", hideModalProduct);
      document.getElementById("confirmDeleteProduct").addEventListener("click", deleteProduct);
      

</script>

<div id="delCategoryModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div id="delCategoryModalContent" class="bg-white rounded-lg shadow-lg p-5">
        <h3 class="text-lg font-bold mb-4">Konfirmasi Penghapusan</h3>
        <p>Apakah Anda yakin ingin menghapus kategori ini? Tindakan ini tidak dapat dibatalkan.</p>
        <div class="flex justify-end mt-4">
            <button type="button" id="cancelDeleteCategory" class="bg-gray-300 text-black px-4 py-2 rounded mr-2">Batal</button>
            <button type="button" id="confirmDeleteCategory" class="bg-red-500 text-white px-4 py-2 rounded">Hapus</button>
        </div>
    </div>
</div>
<style>

#delCategoryModal {
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
}

#delCategoryModal .bg-white {
    width: 300px; /* Set width of modal */
}

</style>

<script>
    let categoryIdToDelete = null
    const delete_category_modal = document.getElementById('delCategoryModal');
    const delete_category_modalContent = document.getElementById('delCategoryModalContent');
    
      function showModalCategory(categoryId) {
          categoryIdToDelete = categoryId;
          const delete_category_modal = document.getElementById('delCategoryModal');
          const delete_category_modalContent = document.getElementById('delCategoryModalContent');
    
          delete_category_modal.classList.remove('hidden'); 
          setTimeout(() => {
            delete_category_modalContent.classList.remove('opacity-0', 'scale-95');
            delete_category_modalContent.classList.add('opacity-100', 'scale-100');
          }, 50); 
      }
    
      function hideModalCategory() {
          const delete_category_modal = document.getElementById('delCategoryModal');
          const delete_category_modalContent = document.getElementById('delCategoryModalContent');
    
          delete_category_modalContent.classList.remove('opacity-100', 'scale-100');
          delete_category_modalContent.classList.add('opacity-0', 'scale-95');
    
          setTimeout(() => {
            delete_category_modal.classList.add('hidden');
          }, 150); 
      }
      function deleteCategory(){
        window.location.href = `/delete_category/${categoryIdToDelete}`;
      }
      document.getElementById("cancelDeleteCategory").addEventListener("click", hideModalCategory);
      document.getElementById("confirmDeleteCategory").addEventListener("click", deleteCategory);
    
</script>

<script>
    // Event delegation for dynamically created elements
    document.addEventListener("click", function(event) {
        // Add to Wishlist
        if (event.target.closest(".add-wishlist-btn")) {
            const productId = event.target.closest(".add-wishlist-btn").getAttribute("product-entry-id");
            showWishlistModal(productId);
        }

        // Remove from Wishlist
        if (event.target.closest(".wishlist-btn")) {
            const productId = event.target.closest(".wishlist-btn").getAttribute("product-entry-id");
            removeFromWishlist(productId);
        }
    });

    function showWishlistModal(productId) {
        document.getElementById("product-entry-id").value = productId;
        document.getElementById("add-wishlist-modal").classList.remove("hidden");

        // Fetch the list of wishlists for the user
        fetch(`/wishlist/wishlist-json/`, {
            method: "GET",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json",
            },
        })
            .then((response) => response.json())
            .then((data) => {
                const wishlistDropdown = document.getElementById("wishlist-collection");
                wishlistDropdown.innerHTML = ""; // Clear previous options

                // Populate wishlist collection in the dropdown
                if (data.collections.length > 0) {
                    data.collections.forEach((wishlist) => {
                        const option = document.createElement("option");
                        option.value = wishlist.collection_id;
                        option.textContent = wishlist.collection_name;
                        wishlistDropdown.appendChild(option);
                    });
                } else {
                    wishlistDropdown.innerHTML = '<option disabled>No wishlists available</option>';
                }
            })
            .catch((error) => console.error("Error fetching wishlist collection:", error));
    }

    // Close the modal on cancel
    document.getElementById("cancel-add-wishlist").addEventListener("click", function () {
        document.getElementById("add-wishlist-modal").classList.add("hidden");
    });

    // Confirm and add to wishlist without page refresh
    document.getElementById("confirm-add-wishlist").addEventListener("click", function () {
        const selectedWishlist = document.getElementById("wishlist-collection").value;
        const productId = document.getElementById("product-entry-id").value;

        if (selectedWishlist) {
            fetch(`/wishlist/add-to-wishlist/${productId}/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ collection_id: selectedWishlist }),
            })
                .then((response) => {
                    if (response.ok) {
                        location.reload(); // Reload the page to reflect changes
                        document.getElementById("add-wishlist-modal").classList.add("hidden"); // Hide the modal
                    } else {
                        alert("Failed to add to wishlist. Please try again.");
                    }
                })
                .catch((error) => console.error("Error adding to wishlist:", error));
        } else {
            alert("Please select a wishlist.");
        }
    });

    function removeFromWishlist(productId) {
        fetch(`/wishlist/remove-wishlist/${productId}/`, {
            method: "DELETE",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json",
            },
        }).then((response) => {
            if (response.ok) {
                location.reload(); // Refresh the page to update the state
            }
        });
    }
</script>
{% endblock content %}